{
	"$schema": "https://shadcn-svelte.com/schema/registry-item.json",
	"name": "map",
	"title": "Map",
	"type": "registry:ui",
	"description": "A MapLibre-powered map component with markers, popups, tooltips, routes, and controls.",
	"dependencies": [
		"maplibre-gl"
	],
	"devDependencies": [
		"@lucide/svelte@^0.561.0"
	],
	"meta": {
		"author": "MariusLang"
	},
	"css": {
		"@layer base": {
			".maplibregl-popup-content": {
				"@apply bg-transparent! shadow-none! p-0! rounded-none!": {}
			},
			".maplibregl-popup-tip": {
				"@apply hidden!": {}
			}
		}
	},
	"files": [
		{
			"content": "<script lang=\"ts\">\n  import { onMount, onDestroy, setContext, untrack } from \"svelte\";\n  import MapLibreGL from \"maplibre-gl\";\n  import \"maplibre-gl/dist/maplibre-gl.css\";\n\timport { browser } from \"$app/environment\";\n\n\tlet tailwindTheme: \"light\" | \"dark\" = $state(\"light\");\n\n  type MapStyleOption = string | MapLibreGL.StyleSpecification;\n\n  interface Props {\n    children?: import(\"svelte\").Snippet;\n    styles?: {\n      light?: MapStyleOption;\n      dark?: MapStyleOption;\n    };\n    theme?: \"light\" | \"dark\";\n    center?: [number, number];\n    zoom?: number;\n    options?: Omit<MapLibreGL.MapOptions, \"container\" | \"style\">;\n  }\n\n  const defaultStyles = {\n    dark: \"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json\",\n    light: \"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json\",\n  };\n\n  let {\n    children,\n    styles,\n    theme = \"light\",\n    center = [13.405, 52.52],\n    zoom = 11,\n    options = {},\n  }: Props = $props();\n\n  let mapContainer: HTMLDivElement;\n  let map: MapLibreGL.Map | null = $state(null);\n  let isMounted = $state(false);\n  let isLoaded = $state(false);\n  let isStyleLoaded = $state(false);\n  let initialStyleApplied = false;\n\n  const mapStyles = $derived({\n    dark: styles?.dark ?? defaultStyles.dark,\n    light: styles?.light ?? defaultStyles.light,\n  });\n\n\tconst currentStyle = $derived(\n\t\ttailwindTheme === \"dark\"\n\t\t\t? mapStyles.dark\n\t\t\t: mapStyles.light\n\t);\n\n\tconst isReady = $derived(isMounted && isLoaded && isStyleLoaded);\n\n  setContext(\"map\", {\n    getMap: () => map,\n    isLoaded: () => isReady,\n  });\n\n  onMount(() => {\n    isMounted = true;\n\n\t\tif (browser) {\n\t\t\tconst root = document.documentElement;\n\n\t\t\tconst updateTheme = () => {\n\t\t\t\ttailwindTheme = root.classList.contains(\"dark\")\n\t\t\t\t\t? \"dark\"\n\t\t\t\t\t: \"light\";\n\t\t\t};\n\n\t\t\tupdateTheme();\n\n\t\t\tconst observer = new MutationObserver(updateTheme);\n\t\t\tobserver.observe(root, {\n\t\t\t\tattributes: true,\n\t\t\t\tattributeFilter: [\"class\"],\n\t\t\t});\n\n\t\t\tonDestroy(() => observer.disconnect());\n\t\t}\n\n    const mapInstance = new MapLibreGL.Map({\n      container: mapContainer,\n      style: currentStyle,\n      center,\n      zoom,\n      attributionControl: false,\n      ...options,\n    });\n\n    mapInstance.on(\"load\", () => {\n      isLoaded = true;\n    });\n\n    mapInstance.on(\"styledata\", () => {\n      isStyleLoaded = true;\n      initialStyleApplied = true;\n    });\n\n    map = mapInstance;\n  });\n\n  $effect(() => {\n    const style = currentStyle;\n\n    if (!map || !initialStyleApplied) {\n      return;\n    }\n\n    untrack(() => {\n      isStyleLoaded = false;\n      map!.setStyle(style, { diff: true });\n    });\n  });\n\n  onDestroy(() => {\n    map?.remove();\n    map = null;\n    isLoaded = false;\n    isStyleLoaded = false;\n  });\n</script>\n\n<div bind:this={mapContainer} class=\"relative h-full w-full\">\n  {#if !isReady}\n    <div class=\"absolute inset-0 flex items-center justify-center\">\n      <div class=\"flex gap-1\">\n        <span class=\"bg-muted-foreground/60 size-1.5 animate-pulse rounded-full\"></span>\n        <span class=\"bg-muted-foreground/60 size-1.5 animate-pulse rounded-full [animation-delay:150ms]\"></span>\n        <span class=\"bg-muted-foreground/60 size-1.5 animate-pulse rounded-full [animation-delay:300ms]\"></span>\n      </div>\n    </div>\n  {/if}\n  {#if isReady}\n    {@render children?.()}\n  {/if}\n</div>\n",
			"type": "registry:ui",
			"target": "map/Map.svelte"
		},
		{
			"content": "<script lang=\"ts\">\n  import { getContext, setContext } from \"svelte\";\n  import MapLibreGL, { type MarkerOptions } from \"maplibre-gl\";\n\n  type Anchor =\n    | \"center\"\n    | \"top\"\n    | \"bottom\"\n    | \"left\"\n    | \"right\"\n    | \"top-left\"\n    | \"top-right\"\n    | \"bottom-left\"\n    | \"bottom-right\";\n\n  interface Props {\n    longitude: number;\n    latitude: number;\n    children?: import(\"svelte\").Snippet;\n    onclick?: (e: MouseEvent) => void;\n    onmouseenter?: (e: MouseEvent) => void;\n    onmouseleave?: (e: MouseEvent) => void;\n    ondragstart?: (lngLat: { lng: number; lat: number }) => void;\n    ondrag?: (lngLat: { lng: number; lat: number }) => void;\n    ondragend?: (lngLat: { lng: number; lat: number }) => void;\n    draggable?: boolean;\n    anchor?: Anchor;\n    offset?: MarkerOptions[\"offset\"];\n    rotation?: number;\n    pitchAlignment?: MarkerOptions[\"pitchAlignment\"];\n    rotationAlignment?: MarkerOptions[\"rotationAlignment\"];\n  }\n\n  let {\n    longitude,\n    latitude,\n    children,\n    onclick,\n    onmouseenter,\n    onmouseleave,\n    ondragstart,\n    ondrag,\n    ondragend,\n    draggable = false,\n    anchor = \"bottom\",\n    offset,\n    rotation,\n    pitchAlignment,\n    rotationAlignment,\n  }: Props = $props();\n\n  const mapCtx = getContext<{\n    getMap: () => MapLibreGL.Map | null;\n    isLoaded: () => boolean;\n  }>(\"map\");\n\n  let marker: MapLibreGL.Marker | null = $state(null);\n  let markerElement: HTMLDivElement | null = $state(null);\n  let isReady = $state(false);\n\n  // Provide marker context for child components\n  setContext(\"marker\", {\n    getMarker: () => marker,\n    getElement: () => markerElement,\n    getMap: () => mapCtx.getMap(),\n    isReady: () => isReady,\n  });\n\n  // Create marker when map is ready\n  $effect(() => {\n    const map = mapCtx.getMap();\n    const mapLoaded = mapCtx.isLoaded();\n\n    if (!map || !mapLoaded) return;\n\n    // Validate coordinates\n    if (typeof longitude !== \"number\" || typeof latitude !== \"number\" ||\n        Number.isNaN(longitude) || Number.isNaN(latitude)) {\n      return;\n    }\n\n    // Create container element programmatically\n    const container = document.createElement(\"div\");\n    container.className = \"cursor-pointer\";\n    markerElement = container;\n\n    // Build marker options\n    const markerOptions: MarkerOptions = {\n      element: container,\n      draggable,\n      anchor,\n    };\n\n    if (offset !== undefined) markerOptions.offset = offset;\n    if (rotation !== undefined) markerOptions.rotation = rotation;\n    if (pitchAlignment !== undefined) markerOptions.pitchAlignment = pitchAlignment;\n    if (rotationAlignment !== undefined) markerOptions.rotationAlignment = rotationAlignment;\n\n    // Create and add marker\n    const markerInstance = new MapLibreGL.Marker(markerOptions)\n      .setLngLat([longitude, latitude])\n      .addTo(map);\n\n    marker = markerInstance;\n\n    // Mouse event listeners on the container\n    if (onclick) container.addEventListener(\"click\", onclick);\n    if (onmouseenter) container.addEventListener(\"mouseenter\", onmouseenter);\n    if (onmouseleave) container.addEventListener(\"mouseleave\", onmouseleave);\n\n    // Drag event handlers\n    const handleDragStart = () => {\n      const lngLat = markerInstance.getLngLat();\n      ondragstart?.({ lng: lngLat.lng, lat: lngLat.lat });\n    };\n    const handleDrag = () => {\n      const lngLat = markerInstance.getLngLat();\n      ondrag?.({ lng: lngLat.lng, lat: lngLat.lat });\n    };\n    const handleDragEnd = () => {\n      const lngLat = markerInstance.getLngLat();\n      ondragend?.({ lng: lngLat.lng, lat: lngLat.lat });\n    };\n\n    if (draggable) {\n      markerInstance.on(\"dragstart\", handleDragStart);\n      markerInstance.on(\"drag\", handleDrag);\n      markerInstance.on(\"dragend\", handleDragEnd);\n    }\n\n    isReady = true;\n\n    // Cleanup\n    return () => {\n      if (onclick) container.removeEventListener(\"click\", onclick);\n      if (onmouseenter) container.removeEventListener(\"mouseenter\", onmouseenter);\n      if (onmouseleave) container.removeEventListener(\"mouseleave\", onmouseleave);\n\n      if (draggable) {\n        markerInstance.off(\"dragstart\", handleDragStart);\n        markerInstance.off(\"drag\", handleDrag);\n        markerInstance.off(\"dragend\", handleDragEnd);\n      }\n\n      markerInstance.remove();\n      marker = null;\n      markerElement = null;\n      isReady = false;\n    };\n  });\n\n  // Update position when coordinates change\n  $effect(() => {\n    if (marker && typeof longitude === \"number\" && typeof latitude === \"number\" &&\n        !Number.isNaN(longitude) && !Number.isNaN(latitude)) {\n      marker.setLngLat([longitude, latitude]);\n    }\n  });\n\n  // Update draggable when prop changes\n  $effect(() => {\n    marker?.setDraggable(draggable);\n  });\n</script>\n\n<!-- Children are MarkerContent, MarkerPopup, MarkerTooltip -->\n{@render children?.()}\n",
			"type": "registry:ui",
			"target": "map/MapMarker.svelte"
		},
		{
			"content": "<script lang=\"ts\">\n  import { getContext } from \"svelte\";\n  import MapLibreGL from \"maplibre-gl\";\n  import { cn } from \"$UTILS$.js\";\n\n  interface Props {\n    children?: import(\"svelte\").Snippet;\n    class?: string;\n  }\n\n  let { children, class: className }: Props = $props();\n\n  const markerCtx = getContext<{\n    getMarker: () => MapLibreGL.Marker | null;\n    getElement: () => HTMLDivElement | null;\n    getMap: () => MapLibreGL.Map | null;\n    isReady: () => boolean;\n  }>(\"marker\");\n\n  let wrapperElement: HTMLDivElement | null = $state(null);\n  let movedContent: Node[] = [];\n\n  // Move content to marker element when ready\n  $effect(() => {\n    const element = markerCtx.getElement();\n    const ready = markerCtx.isReady();\n\n    if (!ready || !element || !wrapperElement) return;\n\n    // Store and move children to marker element\n    movedContent = Array.from(wrapperElement.childNodes);\n    movedContent.forEach((child) => element.appendChild(child));\n\n    return () => {\n      // Move content back on cleanup\n      movedContent.forEach((child) => {\n        if (wrapperElement && child.parentNode === element) {\n          wrapperElement.appendChild(child);\n        }\n      });\n      movedContent = [];\n    };\n  });\n</script>\n\n<!-- Hidden wrapper that holds content until marker is ready -->\n<div bind:this={wrapperElement} style=\"display: contents;\">\n  <div class={cn(\"relative cursor-pointer\", className)}>\n    {#if children}\n      {@render children()}\n    {:else}\n      <!-- Default marker icon -->\n      <div class=\"relative h-4 w-4 rounded-full border-2 border-white bg-blue-500 shadow-lg\"></div>\n    {/if}\n  </div>\n</div>\n",
			"type": "registry:ui",
			"target": "map/MarkerContent.svelte"
		},
		{
			"content": "<script lang=\"ts\">\n  import { getContext } from \"svelte\";\n  import MapLibreGL, { type PopupOptions } from \"maplibre-gl\";\n  import { cn } from \"$UTILS$.js\";\n  import X from \"@lucide/svelte/icons/x\";\n\n  interface Props {\n    children?: import(\"svelte\").Snippet;\n    class?: string;\n    closeButton?: boolean;\n    offset?: PopupOptions[\"offset\"];\n    anchor?: PopupOptions[\"anchor\"];\n    closeOnClick?: boolean;\n    closeOnMove?: boolean;\n    focusAfterOpen?: boolean;\n    maxWidth?: string;\n  }\n\n  let {\n    children,\n    class: className,\n    closeButton = false,\n    offset = 16,\n    anchor,\n    closeOnClick,\n    closeOnMove,\n    focusAfterOpen,\n    maxWidth,\n  }: Props = $props();\n\n  const markerCtx = getContext<{\n    getMarker: () => MapLibreGL.Marker | null;\n    getElement: () => HTMLDivElement | null;\n    getMap: () => MapLibreGL.Map | null;\n    isReady: () => boolean;\n  }>(\"marker\");\n\n  let popup: MapLibreGL.Popup | null = null;\n  let containerElement: HTMLDivElement | null = $state(null);\n  let wrapperElement: HTMLDivElement | null = $state(null);\n\n  // Create popup when marker is ready\n  $effect(() => {\n    const marker = markerCtx.getMarker();\n    const ready = markerCtx.isReady();\n\n    if (!ready || !marker || !wrapperElement) return;\n\n    // Create popup container\n    const container = document.createElement(\"div\");\n    containerElement = container;\n\n    // Build popup options\n    const popupOptions: PopupOptions = {\n      offset,\n      closeButton: false,\n      className: \"maplibre-popup-transparent\",\n    };\n\n    if (anchor !== undefined) popupOptions.anchor = anchor;\n    if (closeOnClick !== undefined) popupOptions.closeOnClick = closeOnClick;\n    if (closeOnMove !== undefined) popupOptions.closeOnMove = closeOnMove;\n    if (focusAfterOpen !== undefined) popupOptions.focusAfterOpen = focusAfterOpen;\n\n    // Create popup\n    const popupInstance = new MapLibreGL.Popup(popupOptions)\n      .setDOMContent(container);\n\n    if (maxWidth) {\n      popupInstance.setMaxWidth(maxWidth);\n    } else {\n      popupInstance.setMaxWidth(\"none\");\n    }\n\n    // Attach popup to marker\n    marker.setPopup(popupInstance);\n    popup = popupInstance;\n\n    // Move content to popup container\n    while (wrapperElement.firstChild) {\n      container.appendChild(wrapperElement.firstChild);\n    }\n\n    return () => {\n      // Move content back\n      while (container.firstChild) {\n        wrapperElement?.appendChild(container.firstChild);\n      }\n\n      popupInstance.remove();\n      popup = null;\n      containerElement = null;\n    };\n  });\n\n  function handleClose() {\n    popup?.remove();\n  }\n</script>\n\n<div bind:this={wrapperElement} style=\"display: contents;\">\n  <div\n    class={cn(\n      \"animate-in fade-in-0 zoom-in-95 relative rounded-md border bg-popover p-3 text-popover-foreground shadow-md\",\n      className\n    )}\n  >\n    {#if closeButton}\n      <button\n        type=\"button\"\n        onclick={handleClose}\n        class=\"absolute right-1 top-1 z-10 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\"\n        aria-label=\"Close popup\"\n      >\n        <X class=\"h-4 w-4\" />\n        <span class=\"sr-only\">Close</span>\n      </button>\n    {/if}\n    {@render children?.()}\n  </div>\n</div>\n\n<style>\n  :global(.maplibre-popup-transparent .maplibregl-popup-content) {\n    background: transparent;\n    box-shadow: none;\n    padding: 0;\n  }\n\n  :global(.maplibre-popup-transparent .maplibregl-popup-tip) {\n    display: none;\n  }\n</style>\n",
			"type": "registry:ui",
			"target": "map/MarkerPopup.svelte"
		},
		{
			"content": "<script lang=\"ts\">\n  import { getContext } from \"svelte\";\n  import MapLibreGL, { type PopupOptions } from \"maplibre-gl\";\n  import { cn } from \"$UTILS$.js\";\n\n  interface Props {\n    children?: import(\"svelte\").Snippet;\n    class?: string;\n    offset?: PopupOptions[\"offset\"];\n    anchor?: PopupOptions[\"anchor\"];\n  }\n\n  let {\n    children,\n    class: className,\n    offset = 16,\n    anchor,\n  }: Props = $props();\n\n  const markerCtx = getContext<{\n    getMarker: () => MapLibreGL.Marker | null;\n    getElement: () => HTMLDivElement | null;\n    getMap: () => MapLibreGL.Map | null;\n    isReady: () => boolean;\n  }>(\"marker\");\n\n  let popup: MapLibreGL.Popup | null = null;\n  let wrapperElement: HTMLDivElement | null = $state(null);\n\n  // Create tooltip popup when marker is ready\n  $effect(() => {\n    const marker = markerCtx.getMarker();\n    const markerElement = markerCtx.getElement();\n    const map = markerCtx.getMap();\n    const ready = markerCtx.isReady();\n\n    if (!ready || !marker || !markerElement || !map || !wrapperElement) return;\n\n    // Create popup container\n    const container = document.createElement(\"div\");\n\n    // Build popup options\n    const popupOptions: PopupOptions = {\n      offset,\n      closeOnClick: true,\n      closeButton: false,\n      className: \"maplibre-popup-transparent\",\n    };\n\n    if (anchor !== undefined) popupOptions.anchor = anchor;\n\n    // Create popup\n    const popupInstance = new MapLibreGL.Popup(popupOptions)\n      .setMaxWidth(\"none\")\n      .setDOMContent(container);\n\n    popup = popupInstance;\n\n    // Move content to popup container\n    while (wrapperElement.firstChild) {\n      container.appendChild(wrapperElement.firstChild);\n    }\n\n    // Show on hover\n    const handleMouseEnter = () => {\n      popupInstance.setLngLat(marker.getLngLat()).addTo(map);\n    };\n\n    const handleMouseLeave = () => {\n      popupInstance.remove();\n    };\n\n    markerElement.addEventListener(\"mouseenter\", handleMouseEnter);\n    markerElement.addEventListener(\"mouseleave\", handleMouseLeave);\n\n    return () => {\n      markerElement.removeEventListener(\"mouseenter\", handleMouseEnter);\n      markerElement.removeEventListener(\"mouseleave\", handleMouseLeave);\n\n      // Move content back\n      while (container.firstChild) {\n        wrapperElement?.appendChild(container.firstChild);\n      }\n\n      popupInstance.remove();\n      popup = null;\n    };\n  });\n</script>\n\n<div bind:this={wrapperElement} style=\"display: contents;\">\n  <div\n    class={cn(\n      \"animate-in fade-in-0 zoom-in-95 rounded-md bg-foreground px-2 py-1 text-xs text-background shadow-md\",\n      className\n    )}\n  >\n    {@render children?.()}\n  </div>\n</div>\n\n<style>\n  :global(.maplibre-popup-transparent .maplibregl-popup-content) {\n    background: transparent;\n    box-shadow: none;\n    padding: 0;\n  }\n\n  :global(.maplibre-popup-transparent .maplibregl-popup-tip) {\n    display: none;\n  }\n</style>\n",
			"type": "registry:ui",
			"target": "map/MarkerTooltip.svelte"
		},
		{
			"content": "<script lang=\"ts\">\n  import { cn } from \"$UTILS$.js\";\n\n  interface Props {\n    children?: import(\"svelte\").Snippet;\n    class?: string;\n    position?: \"top\" | \"bottom\";\n  }\n\n  let { children, class: className, position = \"top\" }: Props = $props();\n\n  const positionClasses = {\n    top: \"bottom-full mb-1\",\n    bottom: \"top-full mt-1\",\n  };\n</script>\n\n<div\n  class={cn(\n    \"absolute left-1/2 -translate-x-1/2 whitespace-nowrap\",\n    \"text-[10px] font-medium text-foreground\",\n    positionClasses[position],\n    className\n  )}\n>\n  {@render children?.()}\n</div>\n",
			"type": "registry:ui",
			"target": "map/MarkerLabel.svelte"
		},
		{
			"content": "<script lang=\"ts\">\n  import { getContext } from \"svelte\";\n  import MapLibreGL, { type PopupOptions } from \"maplibre-gl\";\n  import { cn } from \"$UTILS$.js\";\n  import X from \"@lucide/svelte/icons/x\";\n\n  interface Props {\n    longitude: number;\n    latitude: number;\n    children?: import(\"svelte\").Snippet;\n    class?: string;\n    closeButton?: boolean;\n    onclose?: () => void;\n    offset?: PopupOptions[\"offset\"];\n    anchor?: PopupOptions[\"anchor\"];\n    closeOnClick?: boolean;\n    closeOnMove?: boolean;\n    focusAfterOpen?: boolean;\n    maxWidth?: string;\n  }\n\n  let {\n    longitude,\n    latitude,\n    children,\n    class: className,\n    closeButton = false,\n    onclose,\n    offset = 12,\n    anchor,\n    closeOnClick,\n    closeOnMove,\n    focusAfterOpen,\n    maxWidth,\n  }: Props = $props();\n\n  const mapCtx = getContext<{\n    getMap: () => MapLibreGL.Map | null;\n    isLoaded: () => boolean;\n  }>(\"map\");\n\n  let popup: MapLibreGL.Popup | null = null;\n  let wrapperElement: HTMLDivElement | null = $state(null);\n\n  // Create popup when map is ready\n  $effect(() => {\n    const map = mapCtx.getMap();\n    const loaded = mapCtx.isLoaded();\n\n    if (!loaded || !map || !wrapperElement) return;\n\n    // Validate coordinates\n    if (typeof longitude !== \"number\" || typeof latitude !== \"number\" ||\n        Number.isNaN(longitude) || Number.isNaN(latitude)) {\n      return;\n    }\n\n    // Create popup container\n    const container = document.createElement(\"div\");\n\n    // Build popup options\n    const popupOptions: PopupOptions = {\n      offset,\n      closeButton: false,\n      className: \"maplibre-popup-transparent\",\n    };\n\n    if (anchor !== undefined) popupOptions.anchor = anchor;\n    if (closeOnClick !== undefined) popupOptions.closeOnClick = closeOnClick;\n    if (closeOnMove !== undefined) popupOptions.closeOnMove = closeOnMove;\n    if (focusAfterOpen !== undefined) popupOptions.focusAfterOpen = focusAfterOpen;\n\n    // Create popup\n    const popupInstance = new MapLibreGL.Popup(popupOptions)\n      .setDOMContent(container)\n      .setLngLat([longitude, latitude])\n      .addTo(map);\n\n    if (maxWidth) {\n      popupInstance.setMaxWidth(maxWidth);\n    } else {\n      popupInstance.setMaxWidth(\"none\");\n    }\n\n    popup = popupInstance;\n\n    // Handle close event\n    const handleClose = () => onclose?.();\n    popupInstance.on(\"close\", handleClose);\n\n    // Move content to popup container\n    while (wrapperElement.firstChild) {\n      container.appendChild(wrapperElement.firstChild);\n    }\n\n    return () => {\n      popupInstance.off(\"close\", handleClose);\n\n      // Move content back\n      while (container.firstChild) {\n        wrapperElement?.appendChild(container.firstChild);\n      }\n\n      if (popupInstance.isOpen()) {\n        popupInstance.remove();\n      }\n      popup = null;\n    };\n  });\n\n  // Update position when coordinates change\n  $effect(() => {\n    if (popup && typeof longitude === \"number\" && typeof latitude === \"number\" &&\n        !Number.isNaN(longitude) && !Number.isNaN(latitude)) {\n      popup.setLngLat([longitude, latitude]);\n    }\n  });\n\n  function handleClose() {\n    popup?.remove();\n    onclose?.();\n  }\n</script>\n\n<div bind:this={wrapperElement} style=\"display: contents;\">\n  <div\n    class={cn(\n      \"animate-in fade-in-0 zoom-in-95 relative rounded-md border bg-popover p-3 text-popover-foreground shadow-md\",\n      className\n    )}\n  >\n    {#if closeButton}\n      <button\n        type=\"button\"\n        onclick={handleClose}\n        class=\"absolute right-1 top-1 z-10 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\"\n        aria-label=\"Close popup\"\n      >\n        <X class=\"h-4 w-4\" />\n        <span class=\"sr-only\">Close</span>\n      </button>\n    {/if}\n    {@render children?.()}\n  </div>\n</div>\n\n<style>\n  :global(.maplibre-popup-transparent .maplibregl-popup-content) {\n    background: transparent;\n    box-shadow: none;\n    padding: 0;\n  }\n\n  :global(.maplibre-popup-transparent .maplibregl-popup-tip) {\n    display: none;\n  }\n</style>\n",
			"type": "registry:ui",
			"target": "map/MapPopup.svelte"
		},
		{
			"content": "<script lang=\"ts\">\n  import { getContext } from \"svelte\";\n  import MapLibreGL from \"maplibre-gl\";\n  import { cn } from \"$UTILS$.js\";\n  import Plus from \"@lucide/svelte/icons/plus\";\n  import Minus from \"@lucide/svelte/icons/minus\";\n  import Locate from \"@lucide/svelte/icons/locate\";\n  import Maximize from \"@lucide/svelte/icons/maximize\";\n  import Loader2 from \"@lucide/svelte/icons/loader-2\";\n\n  interface Props {\n    position?: \"top-left\" | \"top-right\" | \"bottom-left\" | \"bottom-right\";\n    showZoom?: boolean;\n    showCompass?: boolean;\n    showLocate?: boolean;\n    showFullscreen?: boolean;\n    class?: string;\n    onlocate?: (coords: { longitude: number; latitude: number }) => void;\n  }\n\n  let {\n    position = \"bottom-right\",\n    showZoom = true,\n    showCompass = false,\n    showLocate = false,\n    showFullscreen = false,\n    class: className,\n    onlocate,\n  }: Props = $props();\n\n  const mapCtx = getContext<{\n    getMap: () => MapLibreGL.Map | null;\n    isLoaded: () => boolean;\n  }>(\"map\");\n\n  let waitingForLocation = $state(false);\n  let compassElement: SVGSVGElement | null = $state(null);\n\n  const positionClasses = {\n    \"top-left\": \"top-2 left-2\",\n    \"top-right\": \"top-2 right-2\",\n    \"bottom-left\": \"bottom-2 left-2\",\n    \"bottom-right\": \"bottom-2 right-2\",\n  };\n\n  // Update compass rotation\n  $effect(() => {\n    const map = mapCtx.getMap();\n    const loaded = mapCtx.isLoaded();\n\n    if (!loaded || !map || !compassElement) return;\n\n    const updateRotation = () => {\n      if (!compassElement) return;\n      const bearing = map.getBearing();\n      const pitch = map.getPitch();\n      compassElement.style.transform = `rotateX(${pitch}deg) rotateZ(${-bearing}deg)`;\n    };\n\n    map.on(\"rotate\", updateRotation);\n    map.on(\"pitch\", updateRotation);\n    updateRotation();\n\n    return () => {\n      map.off(\"rotate\", updateRotation);\n      map.off(\"pitch\", updateRotation);\n    };\n  });\n\n  function handleZoomIn() {\n    const map = mapCtx.getMap();\n    map?.zoomTo(map.getZoom() + 1, { duration: 300 });\n  }\n\n  function handleZoomOut() {\n    const map = mapCtx.getMap();\n    map?.zoomTo(map.getZoom() - 1, { duration: 300 });\n  }\n\n  function handleResetBearing() {\n    const map = mapCtx.getMap();\n    map?.resetNorthPitch({ duration: 300 });\n  }\n\n  function handleLocate() {\n    const map = mapCtx.getMap();\n    if (!map) return;\n\n    waitingForLocation = true;\n\n    if (\"geolocation\" in navigator) {\n      navigator.geolocation.getCurrentPosition(\n        (position) => {\n          const coords = {\n            longitude: position.coords.longitude,\n            latitude: position.coords.latitude,\n          };\n          map.flyTo({\n            center: [coords.longitude, coords.latitude],\n            zoom: 14,\n            duration: 1500,\n          });\n          onlocate?.(coords);\n          waitingForLocation = false;\n        },\n        (error) => {\n          console.error(\"Error getting location:\", error);\n          waitingForLocation = false;\n        }\n      );\n    }\n  }\n\n  function handleFullscreen() {\n    const map = mapCtx.getMap();\n    const container = map?.getContainer();\n    if (!container) return;\n\n    if (document.fullscreenElement) {\n      document.exitFullscreen();\n    } else {\n      container.requestFullscreen();\n    }\n  }\n</script>\n\n{#snippet controlButton(onclick: () => void, label: string, disabled: boolean = false)}\n  <button\n    {onclick}\n    aria-label={label}\n    type=\"button\"\n    class={cn(\n      \"flex size-8 items-center justify-center transition-colors hover:bg-accent dark:hover:bg-accent/40\",\n      disabled && \"pointer-events-none cursor-not-allowed opacity-50\"\n    )}\n    {disabled}\n  >\n    {#if $$slots.default}\n      <slot />\n    {/if}\n  </button>\n{/snippet}\n\n{#if mapCtx.isLoaded()}\n  <div\n    class={cn(\n      \"absolute z-10 flex flex-col gap-1.5\",\n      positionClasses[position],\n      className\n    )}\n  >\n    {#if showZoom}\n      <div class=\"flex flex-col overflow-hidden rounded-md border border-border bg-background shadow-sm [&>button:not(:last-child)]:border-b [&>button:not(:last-child)]:border-border\">\n        <button\n          onclick={handleZoomIn}\n          aria-label=\"Zoom in\"\n          type=\"button\"\n          class=\"flex size-8 items-center justify-center transition-colors hover:bg-accent dark:hover:bg-accent/40\"\n        >\n          <Plus class=\"size-4\" />\n        </button>\n        <button\n          onclick={handleZoomOut}\n          aria-label=\"Zoom out\"\n          type=\"button\"\n          class=\"flex size-8 items-center justify-center transition-colors hover:bg-accent dark:hover:bg-accent/40\"\n        >\n          <Minus class=\"size-4\" />\n        </button>\n      </div>\n    {/if}\n\n    {#if showCompass}\n      <div class=\"flex flex-col overflow-hidden rounded-md border border-border bg-background shadow-sm\">\n        <button\n          onclick={handleResetBearing}\n          aria-label=\"Reset bearing to north\"\n          type=\"button\"\n          class=\"flex size-8 items-center justify-center transition-colors hover:bg-accent\"\n        >\n          <svg\n            bind:this={compassElement}\n            viewBox=\"0 0 24 24\"\n            class=\"size-5 transition-transform duration-200\"\n            style=\"transform-style: preserve-3d;\"\n          >\n            <path d=\"M12 2L16 12H12V2Z\" class=\"fill-red-500\" />\n            <path d=\"M12 2L8 12H12V2Z\" class=\"fill-red-300\" />\n            <path d=\"M12 22L16 12H12V22Z\" class=\"fill-muted-foreground/60\" />\n            <path d=\"M12 22L8 12H12V22Z\" class=\"fill-muted-foreground/30\" />\n          </svg>\n        </button>\n      </div>\n    {/if}\n\n    {#if showLocate}\n      <div class=\"flex flex-col overflow-hidden rounded-md border border-border bg-background shadow-sm\">\n        <button\n          onclick={handleLocate}\n          aria-label=\"Find my location\"\n          type=\"button\"\n          class={cn(\n            \"flex size-8 items-center justify-center transition-colors hover:bg-accent dark:hover:bg-accent/40\",\n            waitingForLocation && \"pointer-events-none cursor-not-allowed opacity-50\"\n          )}\n          disabled={waitingForLocation}\n        >\n          {#if waitingForLocation}\n            <Loader2 class=\"size-4 animate-spin\" />\n          {:else}\n            <Locate class=\"size-4\" />\n          {/if}\n        </button>\n      </div>\n    {/if}\n\n    {#if showFullscreen}\n      <div class=\"flex flex-col overflow-hidden rounded-md border border-border bg-background shadow-sm\">\n        <button\n          onclick={handleFullscreen}\n          aria-label=\"Toggle fullscreen\"\n          type=\"button\"\n          class=\"flex size-8 items-center justify-center transition-colors hover:bg-accent dark:hover:bg-accent/40\"\n        >\n          <Maximize class=\"size-4\" />\n        </button>\n      </div>\n    {/if}\n  </div>\n{/if}\n",
			"type": "registry:ui",
			"target": "map/MapControls.svelte"
		},
		{
			"content": "<script lang=\"ts\">\n  import { getContext } from \"svelte\";\n  import MapLibreGL from \"maplibre-gl\";\n\n  interface Props {\n    coordinates: [number, number][];\n    color?: string;\n    width?: number;\n    opacity?: number;\n    dashArray?: [number, number];\n    id?: string;\n  }\n\n  let {\n    coordinates,\n    color = \"#4285F4\",\n    width = 3,\n    opacity = 0.8,\n    dashArray,\n    id = crypto.randomUUID(),\n  }: Props = $props();\n\n  const mapCtx = getContext<{\n    getMap: () => MapLibreGL.Map | null;\n    isLoaded: () => boolean;\n  }>(\"map\");\n\n  const sourceId = `route-source-${id}`;\n  const layerId = `route-layer-${id}`;\n\n  // Add route when map is ready\n  $effect(() => {\n    const map = mapCtx.getMap();\n    const loaded = mapCtx.isLoaded();\n\n    if (!loaded || !map || coordinates.length < 2) return;\n\n    // Remove existing layer and source if they exist\n    if (map.getLayer(layerId)) map.removeLayer(layerId);\n    if (map.getSource(sourceId)) map.removeSource(sourceId);\n\n    // Add source\n    map.addSource(sourceId, {\n      type: \"geojson\",\n      data: {\n        type: \"Feature\",\n        properties: {},\n        geometry: {\n          type: \"LineString\",\n          coordinates,\n        },\n      },\n    });\n\n    // Build paint options\n    const paint: MapLibreGL.LinePaint = {\n      \"line-color\": color,\n      \"line-width\": width,\n      \"line-opacity\": opacity,\n    };\n\n    if (dashArray) {\n      paint[\"line-dasharray\"] = dashArray;\n    }\n\n    // Add layer\n    map.addLayer({\n      id: layerId,\n      type: \"line\",\n      source: sourceId,\n      layout: {\n        \"line-join\": \"round\",\n        \"line-cap\": \"round\",\n      },\n      paint,\n    });\n\n    return () => {\n      try {\n        if (map.getLayer(layerId)) map.removeLayer(layerId);\n        if (map.getSource(sourceId)) map.removeSource(sourceId);\n      } catch {\n        // Ignore errors during cleanup\n      }\n    };\n  });\n\n  // Update route data when coordinates change\n  $effect(() => {\n    const map = mapCtx.getMap();\n    const loaded = mapCtx.isLoaded();\n\n    if (!loaded || !map || coordinates.length < 2) return;\n\n    const source = map.getSource(sourceId) as MapLibreGL.GeoJSONSource | undefined;\n    if (source) {\n      source.setData({\n        type: \"Feature\",\n        properties: {},\n        geometry: {\n          type: \"LineString\",\n          coordinates,\n        },\n      });\n    }\n  });\n\n  // Update paint properties when they change\n  $effect(() => {\n    const map = mapCtx.getMap();\n    const loaded = mapCtx.isLoaded();\n\n    if (!loaded || !map || !map.getLayer(layerId)) return;\n\n    map.setPaintProperty(layerId, \"line-color\", color);\n    map.setPaintProperty(layerId, \"line-width\", width);\n    map.setPaintProperty(layerId, \"line-opacity\", opacity);\n\n    if (dashArray) {\n      map.setPaintProperty(layerId, \"line-dasharray\", dashArray);\n    }\n  });\n</script>\n",
			"type": "registry:ui",
			"target": "map/MapRoute.svelte"
		},
		{
			"content": "export { default as Map } from \"./Map.svelte\";\nexport { default as MapMarker } from \"./MapMarker.svelte\";\nexport { default as MarkerContent } from \"./MarkerContent.svelte\";\nexport { default as MarkerPopup } from \"./MarkerPopup.svelte\";\nexport { default as MarkerTooltip } from \"./MarkerTooltip.svelte\";\nexport { default as MarkerLabel } from \"./MarkerLabel.svelte\";\nexport { default as MapControls } from \"./MapControls.svelte\";\nexport { default as MapPopup } from \"./MapPopup.svelte\";\nexport { default as MapRoute } from \"./MapRoute.svelte\";\n",
			"type": "registry:ui",
			"target": "map/index.ts"
		}
	]
}